<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„±ê²½ìœ¼ë¡œ ë°°ìš°ëŠ” í•œêµ­ì–´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Nanum+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nanum Gothic', 'Inter', sans-serif;
        }
        .highlight {
            background-color: #fef9c3; /* Tailwind yellow-100 */
            font-weight: bold;
        }
        .korean-word {
            cursor: pointer;
            padding: 0 2px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }
        .korean-word:hover {
            background-color: #fde68a; /* Tailwind yellow-300 */
        }
        .vocab-item.highlighted-vocab {
            background-color: #dbeafe; /* Tailwind blue-100 */
            border-left: 4px solid #3b82f6; /* Tailwind blue-500 */
        }
        .speak-btn {
            cursor: pointer;
            margin-left: 8px;
            font-size: 0.9em;
            color: #0ea5e9; /* sky-600 */
        }
        .speak-btn:hover {
            color: #0284c7; /* sky-700 */
        }
        #speak-full-verse-btn {
            background-color: #f0f9ff; /* sky-50 */
            color: #0369a1; /* sky-700 */
            border: 1px solid #bae6fd; /* sky-200 */
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: background-color 0.3s;
        }
        #speak-full-verse-btn:hover {
            background-color: #e0f2fe; /* sky-100 */
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 flex flex-col items-center min-h-screen p-4">

    <div class="container mx-auto max-w-4xl bg-white shadow-xl rounded-lg p-6 md:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-sky-700">ğŸ“– ì„±ê²½ìœ¼ë¡œ ë°°ìš°ëŠ” í•œêµ­ì–´</h1>
            <p class="text-slate-600 mt-2">ì„±ê²½ ë§ì”€ì„ í†µí•´ í•œêµ­ì–´ë¥¼ ì‰½ê³  ì¬ë¯¸ìˆê²Œ ê³µë¶€í•´ ë³´ì„¸ìš”.</p>
        </header>

        <section id="verse-selector" class="mb-8 p-6 bg-sky-50 rounded-lg shadow">
            <h2 class="text-xl font-semibold text-sky-600 mb-4">êµ¬ì ˆ ì„ íƒí•˜ê¸°</h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 items-end">
                <div>
                    <label for="book-select" class="block text-sm font-medium text-slate-700 mb-1">ì„±ê²½:</label>
                    <select id="book-select" class="w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500">
                        </select>
                </div>
                <div>
                    <label for="chapter-select" class="block text-sm font-medium text-slate-700 mb-1">ì¥:</label>
                    <select id="chapter-select" class="w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500">
                        </select>
                </div>
                <div>
                    <label for="verse-select" class="block text-sm font-medium text-slate-700 mb-1">ì ˆ:</label>
                    <select id="verse-select" class="w-full p-2 border border-slate-300 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500">
                        </select>
                </div>
            </div>
            <button id="load-verse-btn" class="mt-6 w-full bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out">
                êµ¬ì ˆ ë¶ˆëŸ¬ì˜¤ê¸°
            </button>
        </section>

        <section id="verse-display-area" class="mb-8">
            <div id="korean-verse-panel" class="p-6 bg-slate-50 rounded-lg shadow mb-6">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-lg font-semibold text-slate-700">í•œêµ­ì–´ ì„±ê²½ (Korean)</h3>
                    <button id="speak-full-verse-btn" class="hidden">êµ¬ì ˆ ì „ì²´ ë°œìŒ ë“£ê¸° ğŸ”ˆ</button>
                </div>
                <p id="korean-verse-text" class="text-xl leading-relaxed whitespace-pre-wrap">êµ¬ì ˆì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
            </div>

            <div id="english-verse-panel" class="p-6 bg-slate-50 rounded-lg shadow mb-6">
                <h3 class="text-lg font-semibold text-slate-700 mb-3">ì˜ì–´ ë²ˆì—­ (English)</h3>
                <p id="english-verse-text" class="text-md leading-relaxed text-slate-600">Select a verse to see the English translation.</p>
            </div>
        </section>

        <section id="vocabulary-area" class="p-6 bg-sky-50 rounded-lg shadow">
            <h3 class="text-lg font-semibold text-sky-600 mb-4">ì£¼ìš” ë‹¨ì–´ ë° í‘œí˜„</h3>
            <div id="vocabulary-list" class="space-y-3">
                <p class="text-slate-500">êµ¬ì ˆì„ ë¶ˆëŸ¬ì˜¤ë©´ ì—¬ê¸°ì— ì£¼ìš” ë‹¨ì–´ì™€ í‘œí˜„ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
                </div>
        </section>

         <div id="message-box" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center hidden z-50">
            <div class="bg-white p-5 rounded-lg shadow-xl max-w-sm w-full mx-4">
                <div class="text-center">
                    <h3 id="message-title" class="text-lg font-medium leading-6 text-gray-900 mb-2">ì•Œë¦¼</h3>
                    <p id="message-text" class="text-sm text-gray-500 mb-4">ë©”ì‹œì§€ ë‚´ìš©</p>
                    <button id="message-ok-btn" class="bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2 px-4 rounded-md shadow-md transition duration-150 ease-in-out w-full">
                        í™•ì¸
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ì„±ê²½ ë°ì´í„° ìƒ˜í”Œ
        const sampleBibleData = {
            "ì°½ì„¸ê¸°": { // Genesis
                1: {
                    1: {
                        korean: "íƒœì´ˆì— í•˜ë‚˜ë‹˜ì´ ì²œì§€ë¥¼ ì°½ì¡°í•˜ì‹œë‹ˆë¼",
                        english: "In the beginning God created the heavens and the earth.",
                        vocabulary: [
                            { key: "íƒœì´ˆì—", word: "íƒœì´ˆì—", meaning: "ì²˜ìŒì—, ë§¨ ì²˜ìŒì— (In the beginning)", grammar: "ë¶€ì‚¬êµ¬ (Adverbial phrase)" },
                            { key: "í•˜ë‚˜ë‹˜ì´", word: "í•˜ë‚˜ë‹˜", meaning: "God", grammar: "ëª…ì‚¬ + ì£¼ê²© ì¡°ì‚¬ 'ì´' (Noun + subject particle)" },
                            { key: "ì²œì§€ë¥¼", word: "ì²œì§€", meaning: "í•˜ëŠ˜ê³¼ ë•… (the heavens and the earth)", grammar: "ëª…ì‚¬ + ëª©ì ê²© ì¡°ì‚¬ 'ë¥¼' (Noun + object particle)" },
                            { key: "ì°½ì¡°í•˜ì‹œë‹ˆë¼", word: "ì°½ì¡°í•˜ì‹œë‹¤", meaning: "ë§Œë“¤ì–´ ë‚´ë‹¤ (to create)", grammar: "ë™ì‚¬ (Verb - formal, declarative ending)" }
                        ],
                        korean_words_parsed: ["íƒœì´ˆì—", "í•˜ë‚˜ë‹˜ì´", "ì²œì§€ë¥¼", "ì°½ì¡°í•˜ì‹œë‹ˆë¼"]
                    }
                }
            },
            "ìš”í•œë³µìŒ": { // John
                3: {
                    16: {
                        korean: "í•˜ë‚˜ë‹˜ì´ ì„¸ìƒì„ ì´ì²˜ëŸ¼ ì‚¬ë‘í•˜ì‚¬ ë…ìƒìë¥¼ ì£¼ì…¨ìœ¼ë‹ˆ ì´ëŠ” ê·¸ë¥¼ ë¯¿ëŠ” ìë§ˆë‹¤ ë©¸ë§í•˜ì§€ ì•Šê³  ì˜ìƒì„ ì–»ê²Œ í•˜ë ¤ í•˜ì‹¬ì´ë¼",
                        english: "For God so loved the world that he gave his one and only Son, that whoever believes in him shall not perish but have eternal life.",
                        vocabulary: [
                            { key: "í•˜ë‚˜ë‹˜ì´", word: "í•˜ë‚˜ë‹˜", meaning: "God", grammar: "ëª…ì‚¬ + ì£¼ê²© ì¡°ì‚¬ 'ì´'" },
                            { key: "ì„¸ìƒì„", word: "ì„¸ìƒ", meaning: "the world", grammar: "ëª…ì‚¬ + ëª©ì ê²© ì¡°ì‚¬ 'ì„'" },
                            { key: "ì´ì²˜ëŸ¼", word: "ì´ì²˜ëŸ¼", meaning: "ì´ë ‡ê²Œ, ì´ì™€ ê°™ì´ (so, in this way)", grammar: "ë¶€ì‚¬ (Adverb)" },
                            { key: "ì‚¬ë‘í•˜ì‚¬", word: "ì‚¬ë‘í•˜ë‹¤", meaning: "to love", grammar: "ë™ì‚¬ í™œìš© (Verb conjugation - connective form)" },
                            { key: "ë…ìƒìë¥¼", word: "ë…ìƒì", meaning: "í•˜ë‚˜ë¿ì¸ ì•„ë“¤ (one and only Son)", grammar: "ëª…ì‚¬ + ëª©ì ê²© ì¡°ì‚¬ 'ë¥¼'" },
                            { key: "ì£¼ì…¨ìœ¼ë‹ˆ", word: "ì£¼ì‹œë‹¤", meaning: "to give (honorific)", grammar: "ë™ì‚¬ í™œìš© (Verb conjugation - reason/cause)" },
                            { key: "ì´ëŠ”", word: "ì´ëŠ”", meaning: "ì´ê²ƒì€ (this is, this means)", grammar: "ëŒ€ëª…ì‚¬ + ì£¼ê²© ì¡°ì‚¬ 'ëŠ”' (Pronoun + topic particle)" },
                            { key: "ê·¸ë¥¼", word: "ê·¸", meaning: "him/her/it", grammar: "ëŒ€ëª…ì‚¬ + ëª©ì ê²© ì¡°ì‚¬ 'ë¥¼'" },
                            { key: "ë¯¿ëŠ”", word: "ë¯¿ë‹¤", meaning: "to believe", grammar: "ë™ì‚¬ í˜„ì¬ ê´€í˜•ì‚¬í˜• (Verb - present adnominal form)" },
                            { key: "ìë§ˆë‹¤", word: "ì", meaning: "ì‚¬ëŒ (person), ê²ƒ (thing)", grammar: "ëª…ì‚¬ + ì¡°ì‚¬ 'ë§ˆë‹¤' (Noun + particle 'each/every')" },
                            { key: "ë©¸ë§í•˜ì§€", word: "ë©¸ë§í•˜ë‹¤", meaning: "ë§í•˜ì—¬ ì—†ì–´ì§€ë‹¤ (to perish)", grammar: "ë™ì‚¬ + ë¶€ì • 'ì•Šê³ ' (Verb + negation)" },
                            { key: "ì•Šê³ ", word: "ì•Šê³ ", meaning: "~í•˜ì§€ ì•Šê³  (without doing, and not)", grammar: "ë³´ì¡° ë™ì‚¬ (Auxiliary verb - negation connective)" },
                            { key: "ì˜ìƒì„", word: "ì˜ìƒ", meaning: "ì˜ì›í•œ ìƒëª… (eternal life)", grammar: "ëª…ì‚¬ + ëª©ì ê²© ì¡°ì‚¬ 'ì„'" },
                            { key: "ì–»ê²Œ", word: "ì–»ë‹¤", meaning: "ê°€ì§€ê±°ë‚˜ ì°¨ì§€í•˜ë‹¤ (to get, to obtain)", grammar: "ë™ì‚¬ + ë³´ì¡° ìš©ì–¸ '-ê²Œ í•˜ë‹¤' (Verb + auxiliary 'to make/let someone do')" },
                            { key: "í•˜ë ¤", word: "í•˜ë ¤", meaning: "~í•˜ë ¤ê³  (in order to, intending to)", grammar: "ë™ì‚¬ ì–´ë¯¸ (Verb ending - intention)" },
                            { key: "í•˜ì‹¬ì´ë¼", word: "í•˜ì‹¬ì´ë¼", meaning: "~í•˜ì…¨ìŠµë‹ˆë‹¤ (formal declarative ending of 'í•˜ì‹œë‹¤')", grammar: "ë™ì‚¬ ì¢…ê²° ì–´ë¯¸ (Verb final ending - formal)" }
                        ],
                        korean_words_parsed: ["í•˜ë‚˜ë‹˜ì´", "ì„¸ìƒì„", "ì´ì²˜ëŸ¼", "ì‚¬ë‘í•˜ì‚¬", "ë…ìƒìë¥¼", "ì£¼ì…¨ìœ¼ë‹ˆ", "ì´ëŠ”", "ê·¸ë¥¼", "ë¯¿ëŠ”", "ìë§ˆë‹¤", "ë©¸ë§í•˜ì§€", "ì•Šê³ ", "ì˜ìƒì„", "ì–»ê²Œ", "í•˜ë ¤", "í•˜ì‹¬ì´ë¼"]
                    }
                }
            },
            "ì‹œí¸": { // Psalms
                23: {
                    1: {
                        korean: "ì—¬í˜¸ì™€ëŠ” ë‚˜ì˜ ëª©ìì‹œë‹ˆ ë‚´ê²Œ ë¶€ì¡±í•¨ì´ ì—†ìœ¼ë¦¬ë¡œë‹¤",
                        english: "The LORD is my shepherd; I shall not want.",
                        vocabulary: [
                            { key: "ì—¬í˜¸ì™€ëŠ”", word: "ì—¬í˜¸ì™€", meaning: "Jehovah, The LORD", grammar: "ëª…ì‚¬ + í† í”½ ì¡°ì‚¬ 'ëŠ”'" },
                            { key: "ë‚˜ì˜", word: "ë‚˜ì˜", meaning: "my", grammar: "ëŒ€ëª…ì‚¬ 'ë‚˜' + ì†Œìœ ê²© ì¡°ì‚¬ 'ì˜'" },
                            { key: "ëª©ìì‹œë‹ˆ", word: "ëª©ì", meaning: "shepherd", grammar: "ëª…ì‚¬ + ì„œìˆ ê²© ì¡°ì‚¬ 'ì´ë‹¤' í™œìš©" },
                            { key: "ë‚´ê²Œ", word: "ë‚´ê²Œ", meaning: "to me, for me", grammar: "ëŒ€ëª…ì‚¬ 'ë‚˜' + ì¡°ì‚¬ 'ì—ê²Œ'" },
                            { key: "ë¶€ì¡±í•¨ì´", word: "ë¶€ì¡±í•¨", meaning: "lack, want, shortage", grammar: "ëª…ì‚¬ + ì£¼ê²© ì¡°ì‚¬ 'ì´'" },
                            { key: "ì—†ìœ¼ë¦¬ë¡œë‹¤", word: "ì—†ë‹¤", meaning: "to not exist, to not have", grammar: "í˜•ìš©ì‚¬ + ë¯¸ë˜ ì¶”ì¸¡ ì–´ë¯¸ '-ìœ¼ë¦¬ë¡œë‹¤'" }
                        ],
                        korean_words_parsed: ["ì—¬í˜¸ì™€ëŠ”", "ë‚˜ì˜", "ëª©ìì‹œë‹ˆ", "ë‚´ê²Œ", "ë¶€ì¡±í•¨ì´", "ì—†ìœ¼ë¦¬ë¡œë‹¤"]
                    }
                }
            },
            "ì ì–¸": { // Proverbs
                3: {
                    5: {
                        korean: "ë„ˆëŠ” ë§ˆìŒì„ ë‹¤í•˜ì—¬ ì—¬í˜¸ì™€ë¥¼ ì‹ ë¢°í•˜ê³  ë„¤ ëª…ì² ì„ ì˜ì§€í•˜ì§€ ë§ë¼",
                        english: "Trust in the LORD with all your heart and lean not on your own understanding;",
                        vocabulary: [
                            { key: "ë„ˆëŠ”", word: "ë„ˆ", meaning: "you (informal)", grammar: "ëŒ€ëª…ì‚¬ + í† í”½ ì¡°ì‚¬ 'ëŠ”'" },
                            { key: "ë§ˆìŒì„", word: "ë§ˆìŒ", meaning: "heart, mind", grammar: "ëª…ì‚¬ + ëª©ì ê²© ì¡°ì‚¬ 'ì„'" },
                            { key: "ë‹¤í•˜ì—¬", word: "ë‹¤í•˜ë‹¤", meaning: "to do one's best, to exhaust", grammar: "ë™ì‚¬ í™œìš© (connective form)" },
                            { key: "ì—¬í˜¸ì™€ë¥¼", word: "ì—¬í˜¸ì™€", meaning: "Jehovah, The LORD", grammar: "ëª…ì‚¬ + ëª©ì ê²© ì¡°ì‚¬ 'ë¥¼'" },
                            { key: "ì‹ ë¢°í•˜ê³ ", word: "ì‹ ë¢°í•˜ë‹¤", meaning: "to trust", grammar: "ë™ì‚¬ + ì—°ê²° ì–´ë¯¸ '-ê³ '" },
                            { key: "ë„¤", word: "ë„¤", meaning: "your (informal)", grammar: "ëŒ€ëª…ì‚¬ 'ë„ˆ'ì˜ ì†Œìœ ê²©" },
                            { key: "ëª…ì² ì„", word: "ëª…ì² ", meaning: "understanding, wisdom", grammar: "ëª…ì‚¬ + ëª©ì ê²© ì¡°ì‚¬ 'ì„'" },
                            { key: "ì˜ì§€í•˜ì§€", word: "ì˜ì§€í•˜ë‹¤", meaning: "to rely on, to depend on", grammar: "ë™ì‚¬ + '-ì§€ ë§ë¼' (prohibitive)" },
                            { key: "ë§ë¼", word: "ë§ë¼", meaning: "do not", grammar: "ëª…ë ¹í˜• ë¶€ì • ì–´ë¯¸" }
                        ],
                        korean_words_parsed: ["ë„ˆëŠ”", "ë§ˆìŒì„", "ë‹¤í•˜ì—¬", "ì—¬í˜¸ì™€ë¥¼", "ì‹ ë¢°í•˜ê³ ", "ë„¤", "ëª…ì² ì„", "ì˜ì§€í•˜ì§€", "ë§ë¼"]
                    },
                    6: {
                        korean: "ë„ˆëŠ” ë²”ì‚¬ì— ê·¸ë¥¼ ì¸ì •í•˜ë¼ ê·¸ë¦¬í•˜ë©´ ë„¤ ê¸¸ì„ ì§€ë„í•˜ì‹œë¦¬ë¼",
                        english: "in all your ways submit to him, and he will make your paths straight.",
                        vocabulary: [
                            { key: "ë„ˆëŠ”ë²”ì‚¬ì—", word: "ë„ˆëŠ”", meaning: "you (informal)", grammar: "ëŒ€ëª…ì‚¬ + í† í”½ ì¡°ì‚¬ 'ëŠ”'" },
                            { key: "ë²”ì‚¬ì—", word: "ë²”ì‚¬", meaning: "all things, every matter", grammar: "ëª…ì‚¬ + ì¡°ì‚¬ 'ì—'" },
                            { key: "ê·¸ë¥¼ì¸ì •í•˜ë¼", word: "ê·¸ë¥¼", meaning: "him", grammar: "ëŒ€ëª…ì‚¬ + ëª©ì ê²© ì¡°ì‚¬ 'ë¥¼'" },
                            { key: "ì¸ì •í•˜ë¼", word: "ì¸ì •í•˜ë‹¤", meaning: "to acknowledge, to admit", grammar: "ë™ì‚¬ + ëª…ë ¹í˜• ì–´ë¯¸ '-ì•„ë¼'" },
                            { key: "ê·¸ë¦¬í•˜ë©´", word: "ê·¸ë¦¬í•˜ë©´", meaning: "if so, then", grammar: "ì ‘ì† ë¶€ì‚¬" },
                            { key: "ë„¤ê¸¸ì„", word: "ë„¤ ê¸¸", meaning: "your path", grammar: "ì†Œìœ ê²© + ëª…ì‚¬ + ëª©ì ê²© ì¡°ì‚¬ 'ì„'" },
                            { key: "ì§€ë„í•˜ì‹œë¦¬ë¼", word: "ì§€ë„í•˜ë‹¤", meaning: "to guide, to direct", grammar: "ë™ì‚¬ + ì¡´ì¹­ ë° ë¯¸ë˜ ì¶”ì¸¡ ì–´ë¯¸" }
                        ],
                        korean_words_parsed: ["ë„ˆëŠ”", "ë²”ì‚¬ì—", "ê·¸ë¥¼", "ì¸ì •í•˜ë¼", "ê·¸ë¦¬í•˜ë©´", "ë„¤", "ê¸¸ì„", "ì§€ë„í•˜ì‹œë¦¬ë¼"]
                    }
                }
            },
            "ë§ˆíƒœë³µìŒ": { // Matthew
                6: {
                    33: {
                        korean: "ê·¸ëŸ°ì¦‰ ë„ˆí¬ëŠ” ë¨¼ì € ê·¸ì˜ ë‚˜ë¼ì™€ ê·¸ì˜ ì˜ë¥¼ êµ¬í•˜ë¼ ê·¸ë¦¬í•˜ë©´ ì´ ëª¨ë“  ê²ƒì„ ë„ˆí¬ì—ê²Œ ë”í•˜ì‹œë¦¬ë¼",
                        english: "But seek first his kingdom and his righteousness, and all these things will be given to you as well.",
                        vocabulary: [
                            { key: "ê·¸ëŸ°ì¦‰", word: "ê·¸ëŸ°ì¦‰", meaning: "therefore, so then", grammar: "ì ‘ì† ë¶€ì‚¬"},
                            { key: "ë„ˆí¬ëŠ”", word: "ë„ˆí¬", meaning: "you (plural/formal)", grammar: "ëŒ€ëª…ì‚¬ + í† í”½ ì¡°ì‚¬ 'ëŠ”'"},
                            { key: "ë¨¼ì €", word: "ë¨¼ì €", meaning: "first", grammar: "ë¶€ì‚¬"},
                            { key: "ê·¸ì˜ë‚˜ë¼ì™€", word: "ê·¸ì˜ ë‚˜ë¼", meaning: "his kingdom", grammar: "ì†Œìœ ê²© + ëª…ì‚¬ + ì ‘ì† ì¡°ì‚¬ 'ì™€'"},
                            { key: "ê·¸ì˜ì˜ë¥¼", word: "ê·¸ì˜ ì˜", meaning: "his righteousness", grammar: "ì†Œìœ ê²© + ëª…ì‚¬ + ëª©ì ê²© ì¡°ì‚¬ 'ë¥¼'"},
                            { key: "êµ¬í•˜ë¼", word: "êµ¬í•˜ë‹¤", meaning: "to seek, to ask for", grammar: "ë™ì‚¬ + ëª…ë ¹í˜• ì–´ë¯¸ '-ì•„ë¼'"},
                            { key: "ê·¸ë¦¬í•˜ë©´ì´", word: "ê·¸ë¦¬í•˜ë©´", meaning: "if so, then", grammar: "ì ‘ì† ë¶€ì‚¬"},
                            { key: "ëª¨ë“ ê²ƒì„", word: "ëª¨ë“  ê²ƒ", meaning: "all things", grammar: "ê´€í˜•ì‚¬ + ëª…ì‚¬ + ëª©ì ê²© ì¡°ì‚¬ 'ì„'"},
                            { key: "ë„ˆí¬ì—ê²Œ", word: "ë„ˆí¬ì—ê²Œ", meaning: "to you (plural/formal)", grammar: "ëŒ€ëª…ì‚¬ + ì¡°ì‚¬ 'ì—ê²Œ'"},
                            { key: "ë”í•˜ì‹œë¦¬ë¼", word: "ë”í•˜ë‹¤", meaning: "to add", grammar: "ë™ì‚¬ + ì¡´ì¹­ ë° ë¯¸ë˜ ì¶”ì¸¡ ì–´ë¯¸"}
                        ],
                        korean_words_parsed: ["ê·¸ëŸ°ì¦‰", "ë„ˆí¬ëŠ”", "ë¨¼ì €", "ê·¸ì˜", "ë‚˜ë¼ì™€", "ê·¸ì˜", "ì˜ë¥¼", "êµ¬í•˜ë¼", "ê·¸ë¦¬í•˜ë©´", "ì´", "ëª¨ë“ ", "ê²ƒì„", "ë„ˆí¬ì—ê²Œ", "ë”í•˜ì‹œë¦¬ë¼"]
                    }
                }
            },
            "ë¹Œë¦½ë³´ì„œ": { // Philippians
                4: {
                    13: {
                        korean: "ë‚´ê²Œ ëŠ¥ë ¥ ì£¼ì‹œëŠ” ì ì•ˆì—ì„œ ë‚´ê°€ ëª¨ë“  ê²ƒì„ í•  ìˆ˜ ìˆëŠë‹ˆë¼",
                        english: "I can do all this through him who gives me strength.",
                        vocabulary: [
                            { key: "ë‚´ê²ŒëŠ¥ë ¥", word: "ë‚´ê²Œ", meaning: "to me", grammar: "ëŒ€ëª…ì‚¬ + ì¡°ì‚¬ 'ì—ê²Œ'"},
                            { key: "ëŠ¥ë ¥", word: "ëŠ¥ë ¥", meaning: "ability, strength, power", grammar: "ëª…ì‚¬"},
                            { key: "ì£¼ì‹œëŠ”", word: "ì£¼ì‹œë‹¤", meaning: "to give (honorific)", grammar: "ë™ì‚¬ + í˜„ì¬ ê´€í˜•ì‚¬í˜• ì–´ë¯¸ '-ëŠ”'"},
                            { key: "ìì•ˆì—ì„œ", word: "ì ì•ˆì—ì„œ", meaning: "in him who", grammar: "ëª…ì‚¬ 'ì' + ì¡°ì‚¬ 'ì•ˆì—ì„œ'"},
                            { key: "ë‚´ê°€", word: "ë‚´ê°€", meaning: "I", grammar: "ëŒ€ëª…ì‚¬ 'ë‚˜' + ì£¼ê²© ì¡°ì‚¬ 'ê°€'"},
                            { key: "ëª¨ë“ ê²ƒì„í• ìˆ˜", word: "ëª¨ë“  ê²ƒì„ í•  ìˆ˜ ìˆë‹¤", meaning: "can do all things", grammar: "ê´€í˜•ì‚¬ + ëª…ì‚¬ + ë™ì‚¬êµ¬"},
                            { key: "ìˆëŠë‹ˆë¼", word: "ìˆë‹¤", meaning: "to be, can", grammar: "í˜•ìš©ì‚¬/ë™ì‚¬ + ì¢…ê²° ì–´ë¯¸ '-ëŠë‹ˆë¼'"}
                        ],
                        korean_words_parsed: ["ë‚´ê²Œ", "ëŠ¥ë ¥", "ì£¼ì‹œëŠ”", "ì", "ì•ˆì—ì„œ", "ë‚´ê°€", "ëª¨ë“ ", "ê²ƒì„", "í• ", "ìˆ˜", "ìˆëŠë‹ˆë¼"]
                    }
                }
            },
             "ë¡œë§ˆì„œ": { // Romans
                8: {
                    28: {
                        korean: "ìš°ë¦¬ê°€ ì•Œê±°ë‹ˆì™€ í•˜ë‚˜ë‹˜ì„ ì‚¬ë‘í•˜ëŠ” ì ê³§ ê·¸ì˜ ëœ»ëŒ€ë¡œ ë¶€ë¥´ì‹¬ì„ ì…ì€ ìë“¤ì—ê²ŒëŠ” ëª¨ë“  ê²ƒì´ í•©ë ¥í•˜ì—¬ ì„ ì„ ì´ë£¨ëŠë‹ˆë¼",
                        english: "And we know that in all things God works for the good of those who love him, who have been called according to his purpose.",
                        vocabulary: [
                            { key: "ìš°ë¦¬ê°€ì•Œê±°ë‹ˆì™€", word: "ìš°ë¦¬ê°€ ì•Œê±°ë‹ˆì™€", meaning: "And we know that", grammar: "ë³µí•© í‘œí˜„"},
                            { key: "í•˜ë‚˜ë‹˜ì„ì‚¬ë‘í•˜ëŠ”ì", word: "í•˜ë‚˜ë‹˜ì„ ì‚¬ë‘í•˜ëŠ” ì", meaning: "those who love God", grammar: "êµ¬ë¬¸"},
                            { key: "ê³§ê·¸ì˜ëœ»ëŒ€ë¡œ", word: "ê³§ ê·¸ì˜ ëœ»ëŒ€ë¡œ", meaning: "who according to his purpose", grammar: "êµ¬ë¬¸"},
                            { key: "ë¶€ë¥´ì‹¬ì„ì…ì€ìë“¤ì—ê²ŒëŠ”", word: "ë¶€ë¥´ì‹¬ì„ ì…ì€ ìë“¤ì—ê²ŒëŠ”", meaning: "to those who have been called", grammar: "êµ¬ë¬¸"},
                            { key: "ëª¨ë“ ê²ƒì´í•©ë ¥í•˜ì—¬", word: "ëª¨ë“  ê²ƒì´ í•©ë ¥í•˜ì—¬", meaning: "all things work together", grammar: "êµ¬ë¬¸"},
                            { key: "ì„ ì„ì´ë£¨ëŠë‹ˆë¼", word: "ì„ ì„ ì´ë£¨ëŠë‹ˆë¼", meaning: "work for the good", grammar: "êµ¬ë¬¸"}
                        ],
                        korean_words_parsed: ["ìš°ë¦¬", "ê°€", "ì•Œê±°ë‹ˆì™€", "í•˜ë‚˜ë‹˜ì„", "ì‚¬ë‘í•˜ëŠ”", "ì", "ê³§", "ê·¸ì˜", "ëœ»ëŒ€ë¡œ", "ë¶€ë¥´ì‹¬ì„", "ì…ì€", "ìë“¤ì—ê²ŒëŠ”", "ëª¨ë“ ", "ê²ƒì´", "í•©ë ¥í•˜ì—¬", "ì„ ì„", "ì´ë£¨ëŠë‹ˆë¼"]
                    }
                }
            }
        };

        // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const bookSelect = document.getElementById('book-select');
        const chapterSelect = document.getElementById('chapter-select');
        const verseSelect = document.getElementById('verse-select');
        const loadVerseBtn = document.getElementById('load-verse-btn');
        const koreanVerseTextElem = document.getElementById('korean-verse-text');
        const englishVerseTextElem = document.getElementById('english-verse-text');
        const vocabularyListElem = document.getElementById('vocabulary-list');
        const speakFullVerseBtn = document.getElementById('speak-full-verse-btn');

        const messageBox = document.getElementById('message-box');
        const messageTitleElem = document.getElementById('message-title');
        const messageTextElem = document.getElementById('message-text');
        const messageOkBtn = document.getElementById('message-ok-btn');
        
        let currentKoreanVerseForSpeech = ""; 

        // Web Speech API ê´€ë ¨
        const synth = window.speechSynthesis;
        let koreanVoice = null;
        let speechApiSupported = ('speechSynthesis' in window);

        function loadKoreanVoice() {
            if (!speechApiSupported) return;

            const voices = synth.getVoices();
            if (voices.length === 0 && synth.onvoiceschanged === undefined) {
                 console.warn("ìŒì„± ëª©ë¡ì„ ì¦‰ì‹œ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ê°€ Web Speech API ìŒì„± ëª©ë¡ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
                 if(speakFullVerseBtn) speakFullVerseBtn.classList.add('hidden');
                 return;
            }
            
            koreanVoice = voices.find(voice => voice.lang === 'ko-KR');
            if (!koreanVoice) {
                koreanVoice = voices.find(voice => voice.lang.startsWith('ko'));
            }

            if (koreanVoice) {
                console.log("í•œêµ­ì–´ ìŒì„± ë¡œë“œë¨:", koreanVoice.name);
                // êµ¬ì ˆì´ ë¡œë“œë˜ë©´ speakFullVerseBtnì€ loadSelectedVerseì—ì„œ ë³´ì´ë„ë¡ ì²˜ë¦¬í•©ë‹ˆë‹¤.
            } else {
                 console.warn("í•œêµ­ì–´ ìŒì„±ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë°œìŒ ë“£ê¸° ê¸°ëŠ¥ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
                 if(speakFullVerseBtn) speakFullVerseBtn.classList.add('hidden');
                 // ì‚¬ìš©ìì—ê²Œ í•œ ë²ˆë§Œ ì•Œë¦¬ëŠ” ê²ƒì´ ì¢‹ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                 // showMessage("ìŒì„± ì§€ì› ì•ˆë‚´", "ì‚¬ìš© ê°€ëŠ¥í•œ í•œêµ­ì–´ ìŒì„±ì´ ì—†ì–´ ë°œìŒ ë“£ê¸° ê¸°ëŠ¥ì´ ì œí•œë©ë‹ˆë‹¤. ë¸Œë¼ìš°ì € ë˜ëŠ” ì‹œìŠ¤í…œì˜ ìŒì„± ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
            }
        }
        
        if (speechApiSupported && synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = loadKoreanVoice;
        }

        function showMessage(title, text) {
            messageTitleElem.textContent = title;
            messageTextElem.textContent = text;
            messageBox.classList.remove('hidden');
        }

        messageOkBtn.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        function speakText(textToSpeak, lang = 'ko-KR') {
            if (!speechApiSupported || !koreanVoice) {
                if (!speechApiSupported) {
                    showMessage("ì•Œë¦¼", "ì£„ì†¡í•©ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ë¸Œë¼ìš°ì €ê°€ ìŒì„± í•©ì„±ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                } else {
                    showMessage("ì•Œë¦¼", "í•œêµ­ì–´ ìŒì„±ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ì–´ ë°œìŒì„ ì¬ìƒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                }
                return;
            }
            if (synth.speaking) {
                synth.cancel(); // ì´ì „ ìŒì„± ì¤‘ì§€
            }

            const utterThis = new SpeechSynthesisUtterance(textToSpeak);
            utterThis.voice = koreanVoice;
            utterThis.lang = koreanVoice.lang; // ë¡œë“œëœ ìŒì„±ì˜ ì–¸ì–´ ì„¤ì • ì‚¬ìš©
            
            utterThis.onerror = (event) => {
                console.error('SpeechSynthesisUtterance error', event);
                let errorMsg = "ìŒì„± ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                 if (event.error === 'synthesis-failed' || event.error === 'audio-busy' || event.error === 'audio-hardware') {
                    errorMsg = "ìŒì„± ì¬ìƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
                } else if (event.error === 'language-unavailable' || event.error === 'voice-unavailable') {
                     errorMsg = "ì„ íƒí•œ ì–¸ì–´ì˜ ìŒì„±ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                }
                showMessage("ìŒì„± ì¬ìƒ ì˜¤ë¥˜", errorMsg);
            };
            synth.speak(utterThis);
        }

        function initializeApp() {
            if (!speechApiSupported) {
                showMessage("ì•Œë¦¼", "ì‚¬ìš©ìë‹˜ì˜ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìŒì„± ë“£ê¸° ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                if(speakFullVerseBtn) speakFullVerseBtn.classList.add('hidden');
            } else {
                loadKoreanVoice(); // í˜ì´ì§€ ë¡œë“œ ì‹œ ìŒì„± ëª©ë¡ ê°€ì ¸ì˜¤ê¸° ì‹œë„
            }

            populateBookDropdown(); 

            if (bookSelect.options.length > 0) {
                bookSelect.selectedIndex = 0; 
                onBookChange(); 
            } else {
                console.error("ì„±ê²½ ì±… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                showMessage("ë°ì´í„° ì˜¤ë¥˜", "ì„±ê²½ ì±… ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.");
            }

            bookSelect.addEventListener('change', onBookChange);
            chapterSelect.addEventListener('change', onChapterChange);
            loadVerseBtn.addEventListener('click', loadSelectedVerse);
            speakFullVerseBtn.addEventListener('click', () => {
                if (currentKoreanVerseForSpeech) {
                    speakText(currentKoreanVerseForSpeech);
                } else {
                    showMessage("ì•Œë¦¼", "ë¨¼ì € êµ¬ì ˆì„ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”.");
                }
            });
        }

        function populateBookDropdown() {
            const books = Object.keys(sampleBibleData);
            bookSelect.innerHTML = books.map(book => `<option value="${book}">${book}</option>`).join('');
        }

        function onBookChange() {
            const selectedBook = bookSelect.value;
            const chapters = Object.keys(sampleBibleData[selectedBook] || {});
            chapterSelect.innerHTML = chapters.map(chapter => `<option value="${chapter}">${chapter}</option>`).join('');
            if (chapterSelect.options.length > 0) {
                 chapterSelect.selectedIndex = 0;
                 onChapterChange(); 
            } else {
                verseSelect.innerHTML = '<option value="">ì ˆ ì—†ìŒ</option>';
            }
        }

        function onChapterChange() {
            const selectedBook = bookSelect.value;
            const selectedChapter = chapterSelect.value;
            if (sampleBibleData[selectedBook] && sampleBibleData[selectedBook][selectedChapter]) {
                const verses = Object.keys(sampleBibleData[selectedBook][selectedChapter] || {});
                verseSelect.innerHTML = verses.map(verse => `<option value="${verse}">${verse}</option>`).join('');
                 if (verseSelect.options.length > 0) {
                    verseSelect.selectedIndex = 0;
                }
            } else {
                 verseSelect.innerHTML = '<option value="">ì ˆ ì—†ìŒ</option>';
            }
        }

        function loadSelectedVerse() {
            const book = bookSelect.value;
            const chapter = chapterSelect.value;
            const verse = verseSelect.value;

            if (!book || !chapter || !verse) {
                showMessage("ì•Œë¦¼", "ì„±ê²½, ì¥, ì ˆì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
                if(speakFullVerseBtn) speakFullVerseBtn.classList.add('hidden');
                return;
            }

            const verseData = sampleBibleData[book]?.[chapter]?.[verse];

            if (verseData) {
                currentKoreanVerseForSpeech = verseData.korean; 
                displayKoreanVerse(verseData.korean, verseData.korean_words_parsed || [], verseData.vocabulary);
                englishVerseTextElem.textContent = verseData.english;
                displayVocabulary(verseData.vocabulary);
                if (speechApiSupported && koreanVoice) { // ìŒì„± API ì§€ì›í•˜ê³  í•œêµ­ì–´ ìŒì„± ìˆì„ ë•Œë§Œ ë²„íŠ¼ í‘œì‹œ
                    speakFullVerseBtn.classList.remove('hidden'); 
                } else {
                    speakFullVerseBtn.classList.add('hidden');
                }
            } else {
                currentKoreanVerseForSpeech = "";
                koreanVerseTextElem.textContent = "ì„ íƒí•œ êµ¬ì ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                englishVerseTextElem.textContent = "Verse not found.";
                vocabularyListElem.innerHTML = '<p class="text-slate-500">ë‹¨ì–´ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                if(speakFullVerseBtn) speakFullVerseBtn.classList.add('hidden');
                showMessage("ì˜¤ë¥˜", "ì„ íƒí•œ êµ¬ì ˆ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
        }
        
        function displayKoreanVerse(koreanText, parsedWords, vocabulary) {
            koreanVerseTextElem.innerHTML = ''; 
            if (parsedWords && parsedWords.length > 0) {
                let tempText = koreanText;
                const wordSpans = [];
                parsedWords.forEach(wordStr => {
                    const index = tempText.indexOf(wordStr);
                    if (index !== -1) {
                        if (index > 0) {
                            wordSpans.push(document.createTextNode(tempText.substring(0, index)));
                        }
                        const span = document.createElement('span');
                        span.textContent = wordStr;
                        span.className = 'korean-word';
                        
                        const vocabEntry = vocabulary.find(v => v.word === wordStr || wordStr.startsWith(v.word) || v.key === wordStr);
                        if (vocabEntry) {
                            span.dataset.vocabKey = vocabEntry.key;
                            span.addEventListener('click', () => { 
                                handleKoreanWordClick(span, vocabEntry.key);
                            });
                        }
                        wordSpans.push(span);
                        tempText = tempText.substring(index + wordStr.length);
                    }
                });
                if (tempText.length > 0) {
                    wordSpans.push(document.createTextNode(tempText));
                }
                wordSpans.forEach(el => koreanVerseTextElem.appendChild(el));

            } else {
                koreanVerseTextElem.textContent = koreanText;
            }
        }

        function displayVocabulary(vocabularyItems) {
            vocabularyListElem.innerHTML = ''; 
            if (!vocabularyItems || vocabularyItems.length === 0) {
                vocabularyListElem.innerHTML = '<p class="text-slate-500">ì´ êµ¬ì ˆì— ëŒ€í•œ ì£¼ìš” ë‹¨ì–´ ì •ë³´ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            vocabularyItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'vocab-item p-3 bg-white border border-slate-200 rounded-md shadow-sm flex justify-between items-center';
                div.dataset.vocabKey = item.key; 

                const textDiv = document.createElement('div');

                const wordStrong = document.createElement('strong');
                wordStrong.className = 'text-sky-700';
                wordStrong.textContent = item.word;
                textDiv.appendChild(wordStrong);

                if (item.grammar) {
                    const grammarSpan = document.createElement('span');
                    grammarSpan.className = 'text-xs text-slate-500 ml-2';
                    grammarSpan.textContent = `(${item.grammar})`;
                    textDiv.appendChild(grammarSpan);
                }
                
                const meaningP = document.createElement('p');
                meaningP.className = 'text-sm text-slate-600 mt-1';
                meaningP.textContent = item.meaning;
                textDiv.appendChild(meaningP);
                
                div.appendChild(textDiv);

                if (speechApiSupported && koreanVoice) { 
                    const speakIcon = document.createElement('span');
                    speakIcon.textContent = 'ğŸ”ˆ';
                    speakIcon.className = 'speak-btn';
                    speakIcon.title = `${item.word} ë°œìŒ ë“£ê¸°`;
                    speakIcon.addEventListener('click', (e) => {
                        e.stopPropagation(); 
                        speakText(item.word);
                    });
                    div.appendChild(speakIcon);
                }
                
                vocabularyListElem.appendChild(div);
            });
        }

        let lastHighlightedWord = null;
        let lastHighlightedVocab = null;

        function handleKoreanWordClick(wordElement, vocabKey) {
            if (lastHighlightedWord) {
                lastHighlightedWord.classList.remove('highlight');
            }
            if (lastHighlightedVocab) {
                lastHighlightedVocab.classList.remove('highlighted-vocab');
            }

            wordElement.classList.add('highlight');
            lastHighlightedWord = wordElement;

            const vocabItemToHighlight = vocabularyListElem.querySelector(`.vocab-item[data-vocab-key="${vocabKey}"]`);
            if (vocabItemToHighlight) {
                vocabItemToHighlight.classList.add('highlighted-vocab');
                vocabItemToHighlight.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                lastHighlightedVocab = vocabItemToHighlight;
            }
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>

</body>
</html>
